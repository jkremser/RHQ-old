<?xml version="1.0" encoding="UTF-8"?>

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:onc="http://jboss.org/on/component"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich">

<ui:composition template="/rhq/layout/main.xhtml">

    <ui:param name="pageTitle" value="Define Alert Notification Templates"/>

    <ui:define name="metaHeaders">
        <style>
            .col1, .col2 {
                vertical-align: top;
                padding: 10px;
            }

            .col2 {
                width: 100%;
            }

            #senderName {
                display: none;
            }
        </style>
    </ui:define>

    <ui:define name="breadcrumbs">
                Define Alert Notifications Templates
    </ui:define>

    <ui:define name="body">
        <br/>
        <h:messages showDetail="true"
                    globalOnly="true"
                    infoClass="InfoBlock"
                    warnClass="WarnBlock"
                    errorClass="ErrorBlock"
                    fatalClass="FatalBlock"
                    layout="table"
                />

        <h:panelGrid columns="2" width="100%" columnClasses="col1,col2">
            <rich:panel id="existingNotificationsPanel">
                <f:facet name="header">
                    <h:outputText>View / edit existing notification templates</h:outputText>
                </f:facet>
                <h:form id="templatesListForm">
                    <rich:scrollableDataTable value="#{notificationTemplateUIBean.notificationTemplates}"
                                       var="template"
                                       first="0"
                                       selection="#{notificationTemplateUIBean.selectedTemplates}"
                                       height="150px"
                                       width="400px"
                            >
                        <rich:column width="150px">
                            <f:facet name="header">
                                <h:outputText value="Name"/>
                            </f:facet>
                            <h:outputText value="#{template.name}"/>
                        </rich:column>

                        <rich:column width="250px">
                            <f:facet name="header">
                                <h:outputText value="Description"/>
                            </f:facet>
                            <h:outputText value="#{template.description}"/>
                        </rich:column>

                    </rich:scrollableDataTable>
                    <h:commandButton id="editTemplateButton"
                                     value="Edit selected Template"
                                     action="#{notificationTemplateUIBean.editNotificationTemplate}"
                                     styleClass="buttonmed"/>

                    <h:commandButton id="deleteTemplateButton"
                                     value="Delete selected Template"
                                     action="#{notificationTemplateUIBean.deleteNotificationTemplate}"
                                     styleClass="buttonmed"/>


                </h:form>
            </rich:panel>
            <rich:panel id="createNewTempaltePanel">
                <f:facet name="header">
                    <h:outputText><b>Create new Template</b></h:outputText>
                </f:facet>
                <h:form id="createNewTemplateForm">
                    <h:outputText>Name</h:outputText>
                    <br/>
                    <h:inputText id="newTemplateNameInput" required="true" maxlength="100" value="#{notificationTemplateUIBean.newTemplateName}"/>
                    <p/>
                    <h:outputText>Description</h:outputText>
                    <br/>
                    <h:inputText id="newTemplateDescriptionInput" required="false" maxlength="100" value="#{notificationTemplateUIBean.newTemplateDescription}"/>

                    <p/>
                    <h:commandButton id="newTemplateButton"
                                     value="Create new Template"
                                     action="#{notificationTemplateUIBean.createNotificationTemplate}"
                                     styleClass="buttonmed"/>
                </h:form>
            </rich:panel>
        </h:panelGrid>

        <rich:panel id="existingAlertsPanel" rendered="#{notificationTemplateUIBean.opMode == 'EDIT'}">
            <f:facet name="header">
                <h:outputText>Existing notifications for Notification Template '#{notificationTemplateUIBean.selectedTemplate.name}':</h:outputText>
            </f:facet>
            <h:panelGrid columns="2" width="100%" columnClasses="col1,col2">
                <h:panelGroup>
                    <h:form id="notificationListForm">

                        <rich:orderingList value="#{notificationTemplateUIBean.alertNotifications}"
                                           var="alertNotification"
                                           selection="#{notificationTemplateUIBean.selectedNotifications}"
                                           activeItem="#{notificationTemplateUIBean.activeNotification}"
                                           converter="#{notificationTemplateUIBean.notificationConverter}"
                                           listWidth="250">
                            <rich:column>
                                <f:facet name="header">
                                    <h:outputText value="Alert Notifications (Select to Edit)" />
                                </f:facet>
                                <h:outputText value="#{alertNotification.name} (#{alertNotification.senderName})" />
                            </rich:column>

                            <a4j:support event="onclick"
                                         ignoreDupResponses="true"
                                         requestDelay="25"
                                         reRender="alertConfig,senderName"
                                         oncomplete="updateCustomContent();" />
                            <a4j:support event="onkeyup"
                                         ignoreDupResponses="true"
                                         requestDelay="150"
                                         reRender="alertConfig,senderName"
                                         oncomplete="updateCustomContent();" />
                            <a4j:support event="onorderchanged"
                                         ignoreDupResponses="true"
                                         requestDelay="250"
                                         reRender="senderName" />
                        </rich:orderingList>
                    </h:form>

                    <h:form id="alertActionButtons">
                        <input type="hidden" name="id" value="${param.id}"/>
                        <input type="hidden" name="ad" value="${param.ad}"/>

                        <h:commandButton id="saveAlertOrderButton"
                                         value="Save Order"
                                         action="#{notificationTemplateUIBean.saveOrder}"
                                         styleClass="buttonmed"/>

                        <h:commandButton id="removeAlertButton"
                                         value="Remove Selected"
                                         action="#{notificationTemplateUIBean.removeSelected}"
                                         styleClass="buttonmed"/>
                    </h:form>
                </h:panelGroup>

                <h:panelGroup>
                    <h:form id="alertConfig">

                        <rich:panel rendered="#{not empty notificationTemplateUIBean.activeNotification.configuration.map}">
                            <f:facet name="header">
                                <h:outputText value="#{notificationTemplateUIBean.activeNotification.senderName} Configuration"/>
                            </f:facet>
                            <onc:config configurationDefinition="#{notificationTemplateUIBean.activeConfigDefinition}"
                                        configuration="#{notificationTemplateUIBean.activeNotification.configuration}" />

                            <h:commandButton id="saveConfigButton"
                                     value="SAVE"
                                     action="#{notificationTemplateUIBean.saveConfiguration}"
                                     styleClass="buttonmed"/>
                        </rich:panel>
                    </h:form>

                    <!-- Custom plugin UI -->
                    <div id="customContentArea"></div>
                </h:panelGroup>
            </h:panelGrid>
        </rich:panel>

        <rich:panel id="addAlertPanel" rendered="#{notificationTemplateUIBean.opMode == 'EDIT'}">
            <f:facet name="header">
                <h:outputText value="Add Alert Notification" />
            </f:facet>

            <h:form id="newNotificationForm">

                <h:outputLabel for="alertNameInput" value="Alert Notification Name:" />
                <br />
                <h:inputText id="alertNameInput"
                             value="#{notificationTemplateUIBean.newAlertName}"
                             maxlength="100"
                             required="true" />

                <h:message for="alertNameInput"
                           infoClass="InfoBlock"
                           warnClass="WarnBlock"
                           errorClass="ErrorBlock"
                           fatalClass="FatalBlock" />
                <br /><br />

                <h:outputLabel for="senderList" value="Alert Sender Type:" />
                <br />
                <h:selectOneMenu id="senderList" value="#{notificationTemplateUIBean.selectedNewSender}">
                    <f:selectItems value="#{notificationTemplateUIBean.allAlertSenders}" />
                </h:selectOneMenu>
                <br /><br />

                <h:commandButton id="addAlertButton"
                                 value="Add Alert Notification"
                                 action="#{notificationTemplateUIBean.addAlertSender}"
                                 styleClass="buttonmed">
                </h:commandButton>

                <a4j:support event="oncomplete"
                         ignoreDupResponses="true"
                         requestDelay="150"
                         reRender="alertConfig,senderName"
                         oncomplete="updateCustomContent();" />
            </h:form>
        </rich:panel>

        <br />
        <br />

        <h:outputText id="senderName"
                      value="#{notificationTemplateUIBean.activeNotification.senderName}" />
        <script>
            function updateCustomContent() {
                var sender = $('senderName').innerHTML;
                new Ajax.Updater('customContentArea',
                                 'customContent.xhtml',
                                 { method: 'get',
                                   parameters: {'senderName': sender}
                                 });
            }

            Event.observe(window, 'load', function() {
                updateCustomContent();
            });
        </script>
    </ui:define>
</ui:composition>

</html>
